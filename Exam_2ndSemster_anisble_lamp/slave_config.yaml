# @format
---
- name: Create Cron Job to Check Server Uptime
  hosts: 127.0.0.1
  become: yes

  tasks:
    - name: Create Cron Job
      cron:
        name: Check Server Uptime
        job: "/usr/bin/uptime > /var/log/uptime.log"
        minute: 0
        hour: 0
      become_user: root

- name: Execute Bash Script and Create Cron Job
  hosts: 127.0.0.1
  become: yes

  tasks:
    - name: Execute lamp.sh Script
      shell: /home/vagrant/lamp_stack.sh
      register: script_output
      ignore_errors: yes

    - name: setup apache laravel application
      shell: /home/vagrant/setup_apache_laravel.sh
      register: script_output2
      ignore_errors: yes

    - name: Verify PHP Application Accessibility
      uri:
        url: http://192.168.129.4
        status_code: 200
      ignore_errors: yes
      register: php_app_check

    - name: Print PHP Application Check
      debug:
        var: php_app_check

    - name: Print PHP Application Check
      debug:
        var: script_output

    - name: Print PHP Application Check
      debug:
        var: script_output2
